---
title: "Data Analysis Report"
author: "Team 9"
date: "2024-10-11"
output: pdf_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE, eval = TRUE)
```

```{r include=FALSE}
# Load Packages
library(readr)
library(ggplot2)
library(dplyr)
library(broom)
library(knitr)
library(kableExtra)
library(car)
```

```{r include=FALSE}
# Importing Data Set
cleaned_data <- read_csv("../../../output/IMDb_dt.csv")
```

```{r include=FALSE}
# Filtering Data
cleaned_data <- cleaned_data %>%
  rename(average_rating = 'The average rating') %>%
  rename(Number_of_episodes = 'Number of episodes') %>%
  filter(!is.na(Number_of_episodes), !is.na(average_rating))
```

# 1. Summary of Descriptive Statistics on Average Ratings
In this section, we present a summary of the descriptive statistics for the average ratings of TV shows. This analysis provides an overview of key metrics such as the mean, median, standard deviation, and range of ratings.
```{r echo=FALSE}
Descriptive_stats <- cleaned_data %>% 
  summarize(
  mean_average_rating = mean(average_rating, na.rm = TRUE),
  median_rating = median(average_rating, na.rm = TRUE),
  min_rating = min(average_rating, na.rm = TRUE),
  max_rating = max(average_rating, na.rm = TRUE),
  num_episodes = n()
)
```

```{r echo=FALSE}
# Creating Descriptive Stats Table
Descriptive_stats_table <- knitr::kable(Descriptive_stats, 
                                  caption = "Summary of Descriptive Statistics on Average Ratings",
                                  digits = 2,  # Format to 2 decimal places
                                  align = 'c',  # Center-align columns
                                  format = "latex")  %>%
                       kable_styling(latex_options = "hold_position") 
# Print the table in the RMarkdown
Descriptive_stats_table
```

# 2. Regressing Rating on Number of Episodes
For this analysis, we decided to use regression analysis to explore the relationship between the number of episodes and the ratings of TV shows. By applying this method, we aim to determine whether the number of episodes significantly impacts a show's rating and to quantify the strength of this relationship. This approach will help us gain insights into how episode count influences audience engagement and reception.

## 2.1 Main Model Without Control Variables
```{r echo=FALSE}
basic_model <- lm(average_rating ~ Number_of_episodes, data = cleaned_data)
summary_bm <- summary(basic_model)

# Extract key statistics
coefficient_summary_bm <- summary_bm$coefficients["Number_of_episodes", "Estimate"]
t_value_bm <- summary_bm$coefficients["Number_of_episodes", "t value"]
p_value_bm <- summary_bm$coefficients["Number_of_episodes", "Pr(>|t|)"]
r_squared_bm <- summary_bm$r.squared
adj_r_squared_bm <- summary_bm$adj.r.squared
f_statistic_bm <- summary_bm$fstatistic[1]
f_statistic_pval <- pf(summary_bm$fstatistic[1], summary_bm$fstatistic[2], summary_bm$fstatistic[3], lower.tail = FALSE)

# Create a tidy summary of the model
tidy_model <- broom::tidy(summary_bm)

# Create a table of the regression results
model_summary_table <- knitr::kable(tidy_model, 
                              caption = "Regression Result: Model without Control Variables",
                              digits = 4,  # Format to 4 decimal places
                              align = 'c',  # Center-align columns
                              format = "latex")   %>%
                       kable_styling(latex_options = "hold_position") 

# Print the model summary table
model_summary_table

# Create a data frame for the additional statistics
stats_df <- tibble::tibble(
  Statistic = c("Coefficient for Number of episodes", "T-value for Number of episodes", 
                "P-value for Number of episodes", "R-squared", 
                "Adjusted R-squared", "F-statistic", "P-value for F-statistic"),
  Value = c(round(coefficient_summary_bm, 6), round(t_value_bm, 4), 
            round(p_value_bm, 6), round(r_squared_bm, 6), 
            round(adj_r_squared_bm, 6), round(f_statistic_bm, 4), 
            round(f_statistic_pval, 6))
)

# Print the additional statistics as a table
knitr::kable(stats_df, caption = "Additional Model Statistics", digits = 4, align = 'c', format = "latex") %>%
  kable_styling(latex_options = "hold_position")
```

```{r echo=FALSE}
## Plot of Basic Model without Control Variables
ggplot(cleaned_data, aes(x = Number_of_episodes, y = average_rating)) +
  geom_point() + geom_smooth(method = "lm") + labs(
    title = "Scatter Plot: Ratings vs. Episodes",
    x = "Number of episodes",
    y = "Average Rating"
  )
```

## 2.2 Regression Output Analysis
In our basic model without any control variables, we observe that the number of episodes has a slightly negative effect on the average IMDb rating. With a p-value smaller than the 5% significance level, we can conclude that the number of episodes has a statistically significant negative effect. However, this model does not include any control variables, so further analysis is needed to expand and refine our model.

\newpage

## 2.3 Main Model With Control Variables
```{r echo=FALSE}
main_model <- lm(average_rating ~ Number_of_episodes + popularity + runtime + new_vs_old + episode_quantity , data = cleaned_data)
summary_mmc <- summary(main_model)

# Extract key statistics
coefficient_summary_mmc <- summary_mmc$coefficients["Number_of_episodes", "Estimate"]
t_value_mmc <- summary_mmc$coefficients["Number_of_episodes", "t value"]
p_value_mmc <- summary_mmc$coefficients["Number_of_episodes", "Pr(>|t|)"]
r_squared_mmc <- summary_mmc$r.squared
adj_r_squared_mmc <- summary_mmc$adj.r.squared
f_statistic_mmc <- summary_mmc$fstatistic[1]
f_statistic_pval_mmc <- pf(summary_mmc$fstatistic[1], summary_mmc$fstatistic[2], summary_mmc$fstatistic[3], lower.tail = FALSE)

# Create a tidy summary of the model
tidy_model_mmc <- broom::tidy(summary_mmc)

# Create a table of the regression results
model_summary_table_mmc <- knitr::kable(tidy_model_mmc, 
                              caption = "Regression Result: Model with Control Variables",
                              digits = 4,  # Format to 4 decimal places
                              align = 'c',  # Center-align columns
                              format = "latex")   %>%
                       kable_styling(latex_options = "hold_position") 

# Print the model summary table
model_summary_table_mmc
```

```{r echo=FALSE}
# Create a data frame for the additional statistics
stats_df_mmc <- tibble::tibble(
  Statistic = c("Coefficient for Number of episodes", "T-value for Number of episodes", 
                "P-value for Number of episodes", "R-squared", 
                "Adjusted R-squared", "F-statistic", "P-value for F-statistic"),
  Value = c(round(coefficient_summary_mmc, 6), round(t_value_mmc, 4), 
            round(p_value_mmc, 6), round(r_squared_mmc, 6), 
            round(adj_r_squared_mmc, 6), round(f_statistic_mmc, 4), 
            round(f_statistic_pval_mmc, 6))
)
# Print the additional statistics as a table
knitr::kable(stats_df_mmc, caption = "Additional Model Statistics", digits = 4, align = 'c', format = "latex") %>%
  kable_styling(latex_options = "hold_position")
```

* popularity: "Amount of votes are over 1000
* runtimeshort: "Runtime in minutes is less than 50"
* new_vs_oldold: "The start year is earlier than 2015"
* episode_quantityMany: "Number of episodes is more than 25"

## 2.4 Regression Output Analysis
In our main model with control variables, we observe that the coefficient for the number of episodes is negative; however, it is not significant, as the p-value for this variable is 0.772, which is greater than 0.05. Looking at our control variables, we find that all of them are significant: Popularity (amount of votes over 1000) has a significant positive effect on the average rating. In contrast, runtime (runtime in minutes is more than 50) has a significant negative effect on the average rating. Additionally, being new (the start year is later than 2015) has a significant negative effect on the average rating, and having many episodes (more than 25 episodes) also negatively affects the average rating.

# 3. Correlation Matrix of the Predictive Variables in Our Main Model
```{r echo=FALSE}
correlation_matrix <- cor(model.matrix(main_model)[, -1])
correlation_df <- as.data.frame(correlation_matrix)
knitr::kable(correlation_df, digits = 4)
```

### Correlation Matrix Analysis:
* Number of episodes has a moderate positive correlation (0.217) with episode quantityMany, indicating that shows with many episodes tend to be classified as having "many" episodes.
* Number of episodes has weak correlations with other variables like popularity (-0.017), runtime (0.022), and new vs old (-0.040), suggesting that the number of episodes is not strongly related to these variables.
* Popularity is weakly and negatively correlated with both new vs old (-0.039) and episode quantityMany (-0.061), indicating that neither older shows nor those with many episodes are strongly related to popularity.
* Runtime has a weak positive correlation (0.049) with new vs old, meaning that older shows may have slightly longer runtimes.
Overall, the relationships between most variables are weak, indicating little to no strong linear correlation between them.The only meaningful correlation is between Number of episodes and episode quantityMany (0.217), which makes sense as it reflects the classification of episode quantity.

# 4. Multicollinearity
```{r echo=FALSE}
vif_values <- vif(main_model)
vif_df <- as.data.frame(vif_values)
colnames(vif_df) <- c("VIF")
knitr::kable(vif_df)
```

### Multicollinearity Analysis:
All VIF values are close to 1, indicating that there is no significant multicollinearity among the variables. This suggests that each variable provides unique information to the model, and none of them are overly redundant.